# MCP RAG Service

**MCP —Å–µ—Ä–≤–∏—Å –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Python RAG Server (DuckDB VSS) v2.0**

–£–ª—É—á—à–µ–Ω–Ω—ã–π MCP —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ KISS (Keep It Simple, Stupid).

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- **`rag_upload_file`** - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ RAG —Å–µ—Ä–≤–µ—Ä
- **`rag_search`** - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º (–≥–∏–±—Ä–∏–¥–Ω—ã–π, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π, –∫–ª—é—á–µ–≤–æ–π) —Å –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞.
- **`rag_get_file_content`** - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- **`rag_similar_documents`** - –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **`rag_analyze_collection`** - –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–∫–ª–∞—Å—Ç–µ—Ä—ã, –≤—ã–±—Ä–æ—Å—ã, —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å)
- **`rag_get_collection_stats`** - –ü–æ–ª—É—á–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ RAG –∫–æ–ª–ª–µ–∫—Ü–∏–∏.
- **`rag_query_direct`** - –ü—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∫ DuckDB VSS

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤:
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ: `.txt`, `.md`
- –î–æ–∫—É–º–µ–Ω—Ç—ã: `.pdf`
- –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–æ–¥: `.py`, `.js`, `.java`, `.c`, `.cpp`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: `.json`, `.yaml`, `.yml`, `.ini`, `.toml`

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- –†–∞–±–æ—Ç–∞—é—â–∏–π Python RAG Server —Å DuckDB VSS
- MCP —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –∫–ª–∏–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, Claude Desktop)

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd mcp-rag-service

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -e .

# –ò–ª–∏ —Å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
pip install -e ".[dev]"
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞:
```bash
docker build -t mcp-rag-service:latest .
```

2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker run --rm -it \
  --network="host" \
  -v "/path/to/your/rag-server/data:/data" \
  mcp-rag-service:latest
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ RAG —Å–µ—Ä–≤–µ—Ä—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é http://localhost:8000) –∏ –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö rag.duckdb.

- `--network="host"`: –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ localhost —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã.
- `-v "/path/to/your/rag-server/data:/data"`: –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É —Å rag.duckdb –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MCP –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Cursor –∏–ª–∏ Claude Desktop)

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤–∞—à–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:

```json
{
  "mcpServers": {
    "rag-vector-service": {
      "command": "docker",
      "args": [
        "run", "--rm", "-i",
        "--network=host",
        "-v", "/path/to/your/rag-server/data:/data",
        "mcp-rag-service:latest"
      ],
      "env": {
        "RAG_SERVER_URL": "http://localhost:8000"
      }
    }
  }
}
```

–ó–∞–º–µ–Ω–∏—Ç–µ `/path/to/your/rag-server/data` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ data –≤–∞—à–µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ RAG —Å–µ—Ä–≤–µ—Ä–∞.

### –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π RAG —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:
```bash
cd /path/to/your/python-rag-server
docker run -p 8000:8000 -v "$(pwd)/data:/app/data" ...
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
await mcp_client.call_tool(
    "rag_upload_file",
    {"file_path": "/path/to/document.pdf"}
)
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫
```python
# –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Å –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º
await mcp_client.call_tool(
    "rag_search",
    {
        "query": "–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏",
        "top_k": 5,
        "search_type": "hybrid",
        "use_reranker": true,
        "expand_query": false
    }
)
```

### –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
```python
# –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
await mcp_client.call_tool(
    "rag_similar_documents",
    {
        "reference_file": "main.py",
        "top_k": 3
    }
)

# –ê–Ω–∞–ª–∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
await mcp_client.call_tool(
    "rag_analyze_collection",
    {
        "analysis_type": "clusters",
        "top_k": 10
    }
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```python
# –ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
await mcp_client.call_tool(
    "rag_get_collection_stats",
    {}
)
```

### –ü—Ä—è–º–æ–π SQL –∑–∞–ø—Ä–æ—Å
```python
# –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
await mcp_client.call_tool(
    "rag_query_direct",
    {
        "sql_query": "SELECT file_name, COUNT(*) FROM chunks GROUP BY file_name"
    }
)
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º
- ‚úÖ Whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
- ‚úÖ SQL injection –∑–∞—â–∏—Ç–∞ –¥–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (SELECT, WITH, SHOW, etc.)
- ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Docker –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
mcp-rag-service/
‚îú‚îÄ‚îÄ Dockerfile                 # Docker-—Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ src/                       # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ rag_mcp_server.py     # –ì–ª–∞–≤–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ rag_client.py         # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è RAG —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ vector_operations.py  # –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils.py              # –£—Ç–∏–ª–∏—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îú‚îÄ‚îÄ examples/                  # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ upload_example.py     # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ search_example.py     # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
‚îÇ   ‚îî‚îÄ‚îÄ analysis_example.py   # –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ pyproject.toml            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

## üß† –í–µ–∫—Ç–æ—Ä–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –∞–Ω–∞–ª–∏–∑–∞:

**–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è**: –ü–æ–∏—Å–∫ —Å–∞–º—ã—Ö –ø–æ—Ö–æ–∂–∏—Ö –ø–∞—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø.

**–ü–æ–∏—Å–∫ –≤—ã–±—Ä–æ—Å–æ–≤**: –í—ã—è–≤–ª–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

**–ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç–∏**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö" –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∞–Ω—ã —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –¥—Ä—É–≥–∏—Ö.

**–ú–∞—Ç—Ä–∏—Ü–∞ similarity**: –ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

## üö¶ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ MCP —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DuckDB VSS  
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–∏—Å–∫–∞
- ‚è≥ REST API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—É–ª—É—á—à–µ–Ω–∏–µ)
- ‚è≥ –¢–µ—Å—Ç—ã
- ‚è≥ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License 